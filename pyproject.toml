[build-system]
requires = [
    "scikit-build-core>=0.8",
    "nanobind>=1.0.0",
    "jaxlib>=0.4.0",
    "numpy>=1.20.0",
]
build-backend = "scikit_build_core.build"

[project]
name = "eigh"
version = "0.1.0"
description = "Differentiable eigenvalue decomposition with JAX (CPU/GPU)"
readme = "README.md"
requires-python = ">=3.10"
license = {text = "Apache-2.0"}
authors = [
    {name = "Igor Sokolov"},
]
maintainers = [
    {name = "Igor Sokolov"},
]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Science/Research",
    "License :: OSI Approved :: Apache Software License",
    "Operating System :: POSIX :: Linux",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Topic :: Scientific/Engineering",
    "Topic :: Scientific/Engineering :: Mathematics",
]
keywords = ["jax", "eigenvalue", "linear-algebra", "gpu", "cuda", "autodiff"]
dependencies = [
    "jax>=0.4.0",
    "jaxlib>=0.4.0",
    "numpy>=1.20.0",
]

[project.optional-dependencies]
cuda = ["jax[cuda12]>=0.4.0"]
cuda-local = ["jax[cuda12-local]>=0.4.0"]
test = ["pytest>=7.0.0", "scipy>=1.7.0"]
dev = ["pytest>=7.0.0", "scipy>=1.7.0"]

[project.urls]
Homepage = "https://github.com/Brogis1/eigh"
Repository = "https://github.com/Brogis1/eigh"
"Original Project" = "https://github.com/fishjojo/pyscfad"

[tool.scikit-build]
cmake.version = ">=3.18"
cmake.build-type = "Release"
build-dir = "build/{wheel_tag}"

# Specify the wheel package locations
wheel.packages = ["src/python/eigh"]

# Use stable ABI for broader Python compatibility
wheel.py-api = ""

[tool.scikit-build.cmake.define]

[tool.cibuildwheel]
build-verbosity = 1
# Skip PyPy, Python 3.8/3.9 (jaxlib compatibility), and musllinux (Alpine)
skip = "pp* cp38-* cp39-* *-musllinux_*"

[tool.cibuildwheel.linux]
# Install BLAS/LAPACK on the build container
before-all = "bash {project}/scripts/install_build_deps.sh"

[tool.cibuildwheel.macos]
# macOS usually finds Accelerate, but we explicitly set deployment target
environment = { MACOSX_DEPLOYMENT_TARGET = "10.15" }
